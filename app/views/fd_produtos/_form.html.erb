<%= form_for(@fd_produto) do |f| %>
  <% if @fd_produto.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@fd_produto.errors.count, "error") %> prohibited this fd_produto from being saved:</h2>

      <ul>
      <% @fd_produto.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>


<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active">
      <a href="#tab1" data-toggle="tab">Produto</a>
    </li>
    <li >
      <a href="#tab2" data-toggle="tab">Variações</a>
    </li>
    <li>
      <a href="#tab3" data-toggle="tab">Itens</a>
    </li>
  </ul>            
<div class="tab-content">
    <div class="tab-pane active" id="tab1"> 
      <br/>
      <div class="row mar-bot40">
          <div class="col-lg-6">
            <%= f.label :Categoria_produto %><br>
            <%= f.select :fd_categoriaproduto_id, options_from_collection_for_select(FdCategoriaproduto.all, 'id', 'desc_categoria',@fd_produto.fd_categoriaproduto_id), {:include_blank => true}, {:onchange => 'changeState(this)', :class => 'form-control' }%>
          </div>  
          <div class="col-lg-6">
            <%= f.label :Nome_Produto %><br>
            <%= f.text_field :nome_produto, :class => 'form-control' %>
          </div>
      </div>
  <br>
  <div class="row mar-bot40">   
       <div class="col-lg-6">
         <%= f.label :Descrição %><br>
         <%= f.text_area :desc_produto, :class => 'form-control' %>
       </div>
  
        <!--Capturando usuario logado-->
        <%=f.hidden_field :fd_empresa_id, :value => user.fd_empresa_id%> 

      </div> 
    </div>

     <div class="tab-pane" id="tab2">
       <br/>
      <div class="row mar-bot40">
        <div class="col-lg-4">  
          <div class="checkbox">
            <label><input type="checkbox" id ="check" onclick ="marcacheck()" value="">Produto Único ?</label>
          </div>
        </div>
      </div>
       <br/>

      <div class="row mar-bot40">
          <div class="col-lg-4"> 
           <b>Variação</b>      
            <%= select_tag("variacao_id", options_from_collection_for_select(FdVariacao.all, 'id', 'desc_variacao'),{:onchange => 'changeState(this)', :class => 'form-control' }) %>
          </div>
        <div class="col-lg-2">
         <b>Valor Produto</b> 
          <input id="valor_produto" name="valor_produto" value="<%=%>" onkeypress="" type="text" class="form-control">
        </div>
      <div class="row" style="margin-top:20px; margin-left:30px;">
          <button id="bntSalvar" type="button" class="btn btn-success" onclick="salva();">Incluir</button>
      </div>
     </div>
     </div>
      <div class="tab-pane" id="tab3">
       3    
     </div>
  </div>

<hr/>

<% if not @fd_produto %>
    <div class="btn-group" role="group" aria-label="...">
      <button type="submit" class="btn btn-primary btn">
        </span> Salvar
      </button>  
<%else%>

  <input type="hidden" name="fd_produto_id" id="fd_produto_id" value ="<%=@fd_produto.id%>">

<% end %>
<%end%>



<table class="table table-hover" id="tlbparticipantes">
  <thead>
    <tr>
      <th>Variação:</th>
      <th>Preço</th>
      <th></th>     
    </tr>
  </thead>
  <tbody>
    <%@variacao_produto.each do |variacao| %>
      <tr>
        <td><%= variacao.desc_variacao %></td>
        <td><%= variacao.valr_produto %></td>
        <td align='right'>
        <a class="btn btn-default btn-sm" title="" rel="tooltip" href="/sivic_relatorioscelulas/<%=sivic_partevenrelacelula.sivic_relatorioscelula.id%>/sivic_partevenrelacelulas/<%=sivic_partevenrelacelula.id%>" data-method="delete" data-confirm="Deseja excluir o registro?" data-original-title="Excluir"><span class="glyphicon glyphicon-trash" rel="tooltip"></span>
        </a>  
        </div>
      </tr>
    <% end %>
  </tbody>



<script>

function marcacheck(){
    
   if($("#check").is(":checked")){ 
       $("#variacao_id").attr('disabled', 'disabled');
     }else{
      $("#variacao_id").removeAttr('disabled'); 
    }  
}

  $(function() {
     $("#valor_produto").maskMoney({showSymbol:true, symbol:"R$", decimal:",", thousands:"."});
  })


function salva(){
    var variacao 

    if($("#check").is(":checked")){ 
       variacao = 1
     }else{
       variacao = $("#variacao_id").val() 
    } 

    $.ajax({
        url: '<%= insere_variacao_produto_path %>',
        data :
        {
           valr_produto : $('#valor_produto').val()
          ,fd_variaco_id : variacao
          ,fd_produto_id: $('#fd_produto_id').val()

    },

    success: function(data){

         var options = "";
         for (var i in data){
          var item = data[i];

           };

         } 
       })      
    
  }


</script>