<%#encoding: utf-8%>
<div class="row mar-bot40">
  <div class="col-lg-8">
    <div class="tabbable">
      <ul class="nav nav-tabs">
        <li class="active">
          <a href="#tab1" data-toggle="tab">Pedido</a>
        </li>
        <li >
          <a href="#tab2" data-toggle="tab">Produtos</a>
        </li>
        <li>
          <a href="#tab3" data-toggle="tab">Serviços</a>
        </li>               
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="tab1">
          <br/>
          <div class="panel panel-default">
            <div class="panel-heading"><strong>Mesa Nº</strong></div>
              <table class="table table-hover " name="tlbItensPedidos" id="tlbItensPedidos">
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th>Variação</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="bodyTlbItensPedidos">                               
                </tbody>
              </table>
            </div>
          </div>
        <div class="tab-pane" id="tab2">
          <br/>
          <div class="divCategorias">
            <div class="row mar-bot40">
            </div>
          </div>
          <br/>
          <div style="display:block">
          <div class="panel panel-default">
            <div class="panel-heading"><strong>Pizzas</strong></div>
              <table class="table table-hover" name="tlbProdutos" id="tlbProdutos">
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th>Preço</th>
                    <th></th>
                  </tr>
                </thead>

                <tbody id="bodyTlbProdutos">
                            
                </tbody>
              </table>
            </div>   
          </div>         
            
        </div>

        <div class="tab-pane" id="tab3">

          <br/>
          <div class="panel panel-default">
            <div class="panel-heading"><strong>Serviços</strong></div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th>Preço</th>
                    <th>Qtd.</th>
                    <th></th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td>Taxa Garçon</td>
                    <td>10%</td>
                    <td>1</td>
                    <td align="right">
                      <div class="btn-group" role="group" aria-label="...">
                        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>
                        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                      </div>                    
                    </td>
                  </tr>
                  <tr>
                    <td>Cover</td>
                    <td>R$ 5,00</td>
                    <td>3</td>
                    <td align="right">
                      <div class="btn-group" role="group" aria-label="...">
                        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>
                        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                      </div>                    
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>        

            
        </div>        
      </div>
    </div>
  </div>
  <div class="col-lg-4">

    <div class="panel panel-default">
      <!-- Default panel contents -->
      <div class="panel-heading">Comanda</div>
      <div class="panel-body">
        <br/>
        <table width="100%" name="tlbItensComanda" id="tlbItensComanda">
          <tbody id="bodyTlbComanda">
            <tr class="dotted">
              <td align="left">Pizza Moda</td>
              <td align="right">R$ 25,00</td>
            </tr>
          </tbody>                                      
        </table>
      </div>
      <br/>
      <!-- List group -->
      <ul class="list-group">
        <li class="list-group-item">
          <div class="row mar-bot40">
            <div class="col-lg-6">
              <strong>Total:</strong>
            </div>
            <div class="col-lg-6">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">R$</span>
                <input type="text" class="form-control" placeholder="Total" aria-describedby="basic-addon1">
              </div>
            </div>
        </li>
        <li class="list-group-item">
          <div class="row mar-bot40">
            <div class="col-lg-6">
              <strong>Taxas:</strong>
            </div>
            <div class="col-lg-6">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">R$</span>
                <input type="text" class="form-control" placeholder="Taxas" aria-describedby="basic-addon1">
              </div>
            </div>
        </li>
        <li class="list-group-item">
          <div class="row mar-bot40">
            <div class="col-lg-6">
              <strong>Total Geral:</strong>
            </div>
            <div class="col-lg-6">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">R$</span>
                <input type="text" class="form-control" placeholder="Total Geral" aria-describedby="basic-addon1">
              </div>
            </div>
        </li>
        <li class="list-group-item">
          <div class="row mar-bot40">
            <div class="col-lg-6">
              <strong>Dinheiro:</strong>
            </div>
            <div class="col-lg-6">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">R$</span>
                <input type="text" class="form-control" placeholder="Dinheiro" aria-describedby="basic-addon1">
              </div>
            </div>
        </li>
        <li class="list-group-item">
          <div class="row mar-bot40">
            <div class="col-lg-6">
              <strong>Troco:</strong>
            </div>
            <div class="col-lg-6">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">R$</span>
                <input type="text" class="form-control" placeholder="Troco" aria-describedby="basic-addon1">
              </div>
            </div>
        </li>
        <li class="list-group-item">
          <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span> Fechar</button>
          <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-print" aria-hidden="true"></span> Imprimir</button>
        </li>                   
      </ul>
    </div>

  </div>
</div>

<div class="modal fade" id="mdIngredientes">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 id="h4Ingredientes" class="modal-title">Ingredientes</h4>
        <h4 id="h4Adicionais" class="modal-title" style="display:none;">Adicionais</h4>
      </div>
      <div class="modal-body">

        <div id="divIngredientes" name="divIngredientes" style="display:block">
          <!-- Tabela -->
          <table class="table table-hover" name="tlbIngredientes" id="tlbIngredientes">
            <tbody id="bodyIngredientes">
            </tbody>                                      
          </table>
        </div>

        <div id="divAdicionais" name="divAdicionais" style="display:none">
          <!-- Tabela -->
          <table class="table table-hover" name="tlbAdicionais" id="tlbAdicionais">
            <tbody id="bodyAdicionais">
            </tbody>                                      
          </table>
        </div>        

      </div>
      <div class="modal-footer">
        <button type="button" onclick="IngredAdiciona('ingredientes')" class="btn btn-success" >Ingredientes</button>
        <button type="button" onclick="IngredAdiciona('adicionais')" class="btn btn-primary" >Adicionais</button>
        <button type="button"  class="btn btn-danger" data-dismiss="modal">Fechar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="mdTrocas">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 id="h4Trocas" class="modal-title">Trocas</h4>
        <h4 id="h4Escolhas" class="modal-title" style="display:none;">Escolhas</h4>
      </div>
      <div class="modal-body">

        <div id="divTrocas" name="divTrocas" style="display:none">
          <!-- Tabela -->
          <table class="table table-hover" name="tlbTrocas" id="tlbTrocas">
            <tbody id="bodyTrocas">
            </tbody>                                      
          </table>
        </div>

        <div id="divEscolhas" name="divEscolhas" style="display:none">
          <!-- Tabela -->
          <table class="table table-hover" name="tlbEscolhas" id="tlbEscolhas">
            <tbody id="bodyEscolhas">
            </tbody>                                      
          </table>
        </div>        

      </div>
      <div class="modal-footer">
        <button type="button"  class="btn btn-danger" data-dismiss="modal">Fechar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade bs-example-modal-sm" id="mdVariacoes" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="list-group divVariacoes">
      </div>
    </div>
  </div>
</div>

<script>

function realizaTroca(fd_itempedidos_id,fd_produtos_id_desejado,fd_produtos_id_trocado) {
  $.ajax({
    url: '<%= troca_produtos_combo_path %>',
    data : 
    {
        fd_itempedidos_id : fd_itempedidos_id
        ,fd_produtos_id_desejado : fd_produtos_id_desejado
        ,fd_produtos_id_trocado : fd_produtos_id_trocado
    },
    success: function(data){

      var fd_itempedidos_id
      if (data.length > 0){

        for (var i in data) {
          var item = data[i];

            fd_itempedidos_id = item.fd_itempedidos_id;

        };

        exibeDivTrocas(0);
        buscaTrocas(fd_itempedidos_id);
      };      

    }
  })  
}

function exibeDivTrocas(tipo) {

  if (tipo == 0) {
    $("#divEscolhas").hide();
    $("#h4Escolhas").hide();
    $("#divTrocas").show();
    $("#h4Trocas").show();
  } else {
    $("#divEscolhas").show();
    $("#h4Escolhas").show();
    $("#divTrocas").hide();
    $("#h4Trocas").hide();    
  };

}

function exibeTrocas(fd_produtocombos_id,fd_itempedidos_id,fd_produtos_id) {


  $.ajax({
    url: '<%= busca_produto_trocas_path %>',
    data : 
    {
        fd_produtocombos_id : fd_produtocombos_id
    },
    success: function(data){

      if (data.length > 0){

        $("#bodyEscolhas").empty();
        $('#mdTrocas').modal('show')

        for (var i in data) {
          var item = data[i];

            $('#tlbEscolhas').append('<tr><td>'+item.nome_produto+'</td><td align="right"><button type="button" onclick="realizaTroca('+fd_itempedidos_id+','+item.fd_produtos_id+','+fd_produtos_id+')"class="btn btn-default"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button><button type="button" onclick="exibeDivTrocas(0);" class="btn btn-default"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span></button></td></tr>');    

        };

        exibeDivTrocas(1);
      };      

    }
  })  
}

function buscaTrocas(fd_itempedidos_id) {

  $.ajax({
    url: '<%= busca_trocas_path %>',
    data : 
    {
        fd_itempedidos_id : fd_itempedidos_id
    },
    success: function(data){

      $("#bodyTrocas").empty();
      $('#mdTrocas').modal('show')

      for (var i in data) {
        var item = data[i];

          $('#tlbTrocas').append('<tr><td>'+item.nome_produto+'</td><td align="right"><button type="button" onclick="exibeTrocas('+item.fd_produtos_id+','+item.fd_itempedidos_id+','+item.fd_produtos_id+')"class="btn btn-default"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span></button></td></tr>');    

      };

      exibeDivTrocas(0);

    }
  })  
}

function alteraAdicionais(fd_itensadicional_id,numr_acao,fd_itempedido_id) {

  $.ajax({
    url: '<%= insere_adicionais_path %>',
    data : 
    {
        fd_itensadicional_id : fd_itensadicional_id
        ,numr_acao : numr_acao
        ,fd_itempedido_id : fd_itempedido_id

    },
    success: function(data){
      var fd_categoriaproduto_id

      for (var i in data) {
        var item = data[i];

         fd_categoriaproduto_id =  item.fd_categoriaproduto_id;
      };     

      buscaAdicionais(fd_itempedido_id,fd_categoriaproduto_id);
    }
  })  
}

function buscaAdicionais(fd_itempedido_id,fd_categoriaproduto_id) {

  $.ajax({
    url: '<%= busca_itemadicional_path %>',
    data : 
    {
        fd_itempedido_id : fd_itempedido_id
        ,fd_categoriaproduto_id : fd_categoriaproduto_id

    },
    success: function(data){

      $("#bodyAdicionais").empty();

      for (var i in data) {
        var item = data[i];

          if(item.numr_qtd == null){
              item.numr_qtd = ""
          };

          $('#tlbAdicionais').append('<tr><td>'+item.desc_item+'</td><td><span class="badge">'+item.numr_quantidade+'</span></td><td align="right"></td><td align="right"><button type="button" onclick="alteraAdicionais('+item.fd_itensadicional_id+',0,'+item.fd_itempedido_id+')"class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button><button onclick="alteraAdicionais('+item.fd_itensadicional_id+',1,'+item.fd_itempedido_id+')" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></td></tr>');    

      };      

      if (data.length > 0){
        $('#mdIngredientes').modal('show')

      };
    }
  })  
}

function IngredAdiciona(tipo) {


  if (tipo == "ingredientes") {
    $("#divIngredientes").show();
    $("#h4Ingredientes").show();

    $("#divAdicionais").hide();
    $("#h4Adicionais").hide();
  } else {
    $("#divIngredientes").hide();
    $("#h4Ingredientes").hide();

    $("#divAdicionais").show();
    $("#h4Adicionais").show();
  };

}

function alteraingredientes(fd_itempedido_id,numr_acao,fd_items_id) {

  $.ajax({
    url: '<%= insere_ingredientealterado_path %>',
    data : 
    {
        fd_items_id : fd_items_id
        ,fd_itempedido_id : fd_itempedido_id
        ,numr_acao : numr_acao

    },
    success: function(data){
      buscaIngredientes(fd_itempedido_id);
    }
  })  
}


function buscaIngredientes(fd_itempedido_id) {

  $.ajax({
    url: '<%= busca_item_path %>',
    data : 
    {
        fd_itempedido_id : fd_itempedido_id

    },
    success: function(data){

      $("#bodyIngredientes").empty();

      for (var i in data) {
        var item = data[i];

          if(item.numr_qtd == null){
              item.numr_qtd = ""
          };

          $('#tlbIngredientes').append('<tr><td>'+item.desc_item+'</td><td><span class="badge">'+item.numr_qtd+'</span></td><td align="right"></td><td align="right"><button type="button" onclick="alteraingredientes('+item.fd_itempedido_id+',0,'+item.id+')"class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button><button onclick="alteraingredientes('+item.fd_itempedido_id+',1,'+item.id+')" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></td></tr>');    

      };      

      if (data.length > 0){
        $('#mdIngredientes').modal('show')

      };
    }
  })  
}


function excluiItensPedidos(id) {

  $.ajax({
    url: '<%= exclui_itempedido_path %>',
    data : 
    {
        id : id
    },
    success: function(data){

      buscaItensPedidos(1);

    }
  })  
}


function buscaItensPedidos(fd_pedido_id) {

  $.ajax({
    url: '<%= busca_itempedido_path %>',
    data : 
    {
        fd_pedido_id : fd_pedido_id
    },
    success: function(data){

          $("#bodyTlbItensPedidos").empty();
          $("#bodyTlbComanda").empty();

      for (var i in data) {
        var item = data[i];

          if(item.fd_categoriaproduto_id == 2){

            $('#tlbItensPedidos').append('<tr><td>'+item.desc_produto+'</td><td>'+item.desc_variacao+'</td><td align="right"><div class="btn-group" role="group"></button><button onclick="buscaTrocas('+item.id+'); buscaIngredientes('+item.id+');" type="button" class="btn btn-default"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span></button><button type="button" onclick="excluiItensPedidos('+item.id+')"class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button><button onclick="dobraItemPedido('+item.id+');" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></div></td></tr>');
            
          } else {


            $('#tlbItensPedidos').append('<tr><td>'+item.desc_produto+'</td><td>'+item.desc_variacao+'</td><td align="right"><div class="btn-group" role="group"></button><button onclick="buscaAdicionais('+item.id+','+item.fd_categoriaproduto_id+'); buscaIngredientes('+item.id+');" type="button" class="btn btn-default"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span></button><button type="button" onclick="excluiItensPedidos('+item.id+')"class="btn btn-default"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button><button onclick="dobraItemPedido('+item.id+');" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></div></td></tr>');

          };


          $('#tlbItensComanda').append('<tr class="dotted"><td>'+item.desc_produto+'</td><td>'+item.valr_item+'</td><td align="right"></td></tr>');                         

      };

    }
  })  
}


function alterapedido(fd_itempedido_id) {

  $.ajax({
    url: '<%= dobra_itempedido_path %>',
    data : 
    {
        fd_itempedido_id : fd_itempedido_id

    },
    success: function(data){

      $('#mdVariacoes').modal('hide')
      buscaItensPedidos(1);
    }
  })  
}


function dobraItemPedido(fd_itempedido_id) {

  $.ajax({
    url: '<%= dobra_itempedido_path %>',
    data : 
    {
        fd_itempedido_id : fd_itempedido_id

    },
    success: function(data){

      $('#mdVariacoes').modal('hide')
      buscaItensPedidos(1);
    }
  })  
}

function incluiItemPedido(fd_variacaoproduto_id,valr_produto) {

  $.ajax({
    url: '<%= insere_itempedido_path %>',
    data : 
    {
        desc_observacao : "desc_observacao"
        ,valr_item : valr_produto
        ,tipo_atendimento : 'tipo_atendimento'
        ,fd_variacaoproduto_id : fd_variacaoproduto_id
        ,fd_pedido_id : 1
        ,fd_status_id : 1
        ,fd_funcionario_id : 1
    },
    success: function(data){

      $('#mdVariacoes').modal('hide')
      buscaItensPedidos(1);
    }
  })  
}


function incluiItem(fd_produto_id) {

  $.ajax({
    url: '<%= busca_variacaoprodutos_path %>',
    data : 
    {
        fd_produto_id : fd_produto_id
    },
    success: function(data){

          $('#mdVariacoes').modal('show');

          $("div.divVariacoes").html("");
          $("div.divVariacoes").append('<a href="#" class="list-group-item disabled"><strong>Variações</strong></a>');

      for (var i in data) {
        var item = data[i];

          $("div.divVariacoes").append('<a href="#" class="list-group-item">' + item.desc_variacao + '<span class="badge">+</span></a>');

      };

    }
  })  
}


function buscaVariacoes(fd_produto_id) {

  $.ajax({
    url: '<%= busca_variacaoprodutos_path %>',
    data : 
    {
        fd_produto_id : fd_produto_id
    },
    success: function(data){


          $("div.divVariacoes").html("");
          $("div.divVariacoes").append('<a href="#" class="list-group-item disabled"><strong>Variações</strong></a>');

      for (var i in data) {
        var item = data[i];

          if (data.length == 1){
              incluiItemPedido(item.id,item.valr_produto);
          } else {

            $("div.divVariacoes").append('<a href="javascript:incluiItemPedido('+item.id+','+item.valr_produto+')" class="list-group-item">' + item.desc_variacao + '<span class="badge">+</span></a>');

          };
      };

      if (data.length != 1){

        $('#mdVariacoes').modal('show');

      }

    }
  })  
}


function buscaCategorias(father_id) {

  $.ajax({
    url: '<%= buscaCategoriaProdutos_path %>',
    data : 
    {
        father_id : father_id
    },
    success: function(data){

    buscaprodutos(father_id);

    $("div.divCategorias").html("");
    $("div.divCategorias").append("<button type='button' onclick='buscaCategorias();' class='btn btn-primary btn-lg'>Geral</button>");
      for (var i in data) {
        var item = data[i];

        $("div.divCategorias").append("<button type='button' onclick='buscaCategorias("+ item.id +");' class='btn btn-default btn-lg'>" + item.desc_categoria + "</button>");

      };

    }
  })  
}

function buscaItensdoCombo(combo_id){

  alert(combo_id);
  
}

function buscaprodutos(fd_categoriaproduto_id) {

  $.ajax({
    url: '<%= busca_produtos_path %>',
    data : 
    {
        fd_categoriaproduto_id : fd_categoriaproduto_id
    },
    success: function(data){

          $("#bodyTlbProdutos").empty();

      for (var i in data) {
        var item = data[i];

          //Caso seja um combo
          if(fd_categoriaproduto_id == 2){

            $('#tlbProdutos').append('<tr><td>'+item.nome_produto+'</td><td>R$</td><td align="right"><button type="button" onclick="buscaVariacoes('+item.id+')" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></td></tr>');              

          }else {

            $('#tlbProdutos').append('<tr><td>'+item.nome_produto+'</td><td>R$</td><td align="right"><button type="button" onclick="buscaVariacoes('+item.id+')" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></td></tr>');         

          }


      };

    }
  })  
}

buscaCategorias();
buscaItensPedidos(1);
</script>